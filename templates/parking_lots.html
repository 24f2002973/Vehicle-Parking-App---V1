{% extends "layout.html" %}
{% block content %}
<h2>Parking Lots</h2>
{% if session.get('is_admin') %}
  <div class="mb-4">
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addLotModal">Add Parking Lot</button>
  </div>
  <div class="modal fade" id="addLotModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add Parking Lot</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form method="post" action="{{ url_for('manage_lots') }}">
          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input type="text" class="form-control" name="name" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Price (per hour)</label>
              <input type="number" step="0.01" class="form-control" name="price" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Address</label>
              <input type="text" class="form-control" name="address" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Pincode</label>
              <input type="text" class="form-control" name="pincode" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Maximum Spots</label>
              <input type="number" min="1" class="form-control" name="max_spots" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Add</button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endif %}
<table class="table table-striped mt-3">
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Address</th>
      <th>Price</th>
      <th>Max Spots</th>
      {% if session.get('is_admin') %}
        <th>Actions</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% for lot in lots %}
      <tr>
        <td>{{ lot.id }}</td>
        <td>{{ lot.name }}</td>
        <td>{{ lot.address }}</td>
        <td>{{ lot.price }}</td>
        <td>{{ lot.max_spots }}</td>
        {% if session.get('is_admin') %}
          <td>
            <a href="{{ url_for('view_spots', lot_id=lot.id) }}" class="btn btn-info btn-sm">View Spots</a>
            <form method="post" action="{{ url_for('delete_lot', lot_id=lot.id) }}" class="d-inline">
              <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this lot?')">Delete</button>
            </form>
            <a href="{{ url_for('edit_lot_spots', lot_id=lot.id) }}" class="btn btn-warning btn-sm">Edit Spots</a>
          </td>
        {% endif %}
        {% if not session.get('is_admin') %}
          <td>
            <form method="post" action="{{ url_for('reserve_spot', lot_id=lot.id) }}">
              <button type="submit" class="btn btn-primary btn-sm">Reserve Spot</button>
            </form>
          </td>
        {% endif %}
      </tr>
    {% endfor %}
  </tbody>
</table>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}